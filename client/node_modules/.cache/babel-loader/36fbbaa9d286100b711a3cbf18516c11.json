{"ast":null,"code":"var _jsxFileName = \"/home/thuong/hedspi-social/client/src/components/Search/Search.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useContext, useState } from 'react';\nimport { collection, or, query, where, getDocs, setDoc, doc, updateDoc, serverTimestamp, getDoc } from 'firebase/firestore';\nimport { db } from '../../firebase';\nimport { AuthContext } from '../../context/AuthContext';\nimport { SearchOutlined } from '@ant-design/icons';\nimport { Input } from 'antd';\nimport './search.scss';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Search = () => {\n  _s();\n\n  const [username, setUsername] = useState('');\n  const [user, setUser] = useState(null);\n  const [err, setErr] = useState(false);\n  const {\n    currentUser\n  } = useContext(AuthContext);\n\n  const handleSearch = async () => {\n    const q = query(collection(db, 'users'), where('displayName', '>=', username), where('displayName', '<', username + '\\uf8ff'));\n\n    try {\n      const querySnapshot = await getDocs(q);\n      querySnapshot.forEach(doc => {\n        setUser(doc.data());\n        console.log(doc.data());\n      });\n    } catch (err) {\n      setErr(true);\n    }\n  };\n\n  const handleKey = e => {\n    e.code === 'Enter' && handleSearch();\n  };\n\n  const handleSelect = async () => {\n    //check whether the group(chats in firestore) exists, if not create\n    const combinedId = currentUser.uid > user.uid ? currentUser.uid + user.uid : user.uid + currentUser.uid;\n\n    try {\n      console.log('idc', combinedId);\n      const res = await getDoc(doc(db, 'chats', combinedId));\n\n      if (!res.exists()) {\n        //create a chat in chats collection\n        await setDoc(doc(db, 'chats', combinedId), {\n          messages: []\n        }); //create user chats\n\n        await updateDoc(doc(db, 'userChats', currentUser.uid), {\n          [combinedId + '.userInfo']: {\n            uid: user.uid,\n            displayName: user.displayName,\n            photoURL: user.photoURL\n          },\n          [combinedId + '.date']: serverTimestamp()\n        });\n        await updateDoc(doc(db, 'userChats', user.uid), {\n          [combinedId + '.userInfo']: {\n            uid: currentUser.uid,\n            displayName: currentUser.displayName,\n            photoURL: currentUser.photoURL\n          },\n          [combinedId + '.date']: serverTimestamp()\n        });\n      }\n    } catch (err) {}\n\n    setUser(null);\n    setUsername('');\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"search\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"search-input\",\n      children: [/*#__PURE__*/_jsxDEV(SearchOutlined, {\n        style: {\n          fontSize: 18\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Find a user\",\n        onKeyDown: handleKey,\n        onChange: e => setUsername(e.target.value),\n        value: username\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 13\n    }, this), err && /*#__PURE__*/_jsxDEV(\"span\", {\n      children: \"User not found!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 21\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"search-list\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 15\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 13\n    }, this), user && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"userChat\",\n      onClick: handleSelect,\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        src: user.photoURL,\n        alt: \"\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"userChatInfo\",\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          children: user.displayName\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 9\n  }, this);\n};\n\n_s(Search, \"0TL1/xta6YBxFXSVMHNE/rXjUUY=\");\n\n_c = Search;\nexport default Search;\n\nvar _c;\n\n$RefreshReg$(_c, \"Search\");","map":{"version":3,"sources":["/home/thuong/hedspi-social/client/src/components/Search/Search.jsx"],"names":["React","useContext","useState","collection","or","query","where","getDocs","setDoc","doc","updateDoc","serverTimestamp","getDoc","db","AuthContext","SearchOutlined","Input","Search","username","setUsername","user","setUser","err","setErr","currentUser","handleSearch","q","querySnapshot","forEach","data","console","log","handleKey","e","code","handleSelect","combinedId","uid","res","exists","messages","displayName","photoURL","fontSize","target","value"],"mappings":"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","sourcesContent":["import React, { useContext, useState } from 'react';\nimport { collection,or, query, where, getDocs, setDoc, doc, updateDoc, serverTimestamp, getDoc } from 'firebase/firestore';\nimport { db } from '../../firebase';\nimport { AuthContext } from '../../context/AuthContext';\nimport { SearchOutlined } from '@ant-design/icons';\nimport { Input } from 'antd';\n\nimport './search.scss';\n\nconst Search = () => {\n    const [username, setUsername] = useState('');\n    const [user, setUser] = useState(null);\n    const [err, setErr] = useState(false);\n\n    const { currentUser } = useContext(AuthContext);\n\n    const handleSearch = async () => {\n        const q = query(collection(db, 'users'), where('displayName', '>=', username), where('displayName', '<', username + '\\uf8ff'));\n\n        try {\n            const querySnapshot = await getDocs(q);\n            querySnapshot.forEach((doc) => {\n                setUser(doc.data());\n                console.log(doc.data());\n            });\n        } catch (err) {\n            setErr(true);\n        }\n    };\n\n    const handleKey = (e) => {\n        e.code === 'Enter' && handleSearch();\n    };\n\n    const handleSelect = async () => {\n        //check whether the group(chats in firestore) exists, if not create\n        const combinedId = currentUser.uid > user.uid ? currentUser.uid + user.uid : user.uid + currentUser.uid;\n        try {\n            console.log('idc', combinedId);\n            const res = await getDoc(doc(db, 'chats', combinedId));\n\n            if (!res.exists()) {\n                //create a chat in chats collection\n                await setDoc(doc(db, 'chats', combinedId), { messages: [] });\n\n                //create user chats\n                await updateDoc(doc(db, 'userChats', currentUser.uid), {\n                    [combinedId + '.userInfo']: {\n                        uid: user.uid,\n                        displayName: user.displayName,\n                        photoURL: user.photoURL,\n                    },\n                    [combinedId + '.date']: serverTimestamp(),\n                });\n\n                await updateDoc(doc(db, 'userChats', user.uid), {\n                    [combinedId + '.userInfo']: {\n                        uid: currentUser.uid,\n                        displayName: currentUser.displayName,\n                        photoURL: currentUser.photoURL,\n                    },\n                    [combinedId + '.date']: serverTimestamp(),\n                });\n            }\n        } catch (err) {}\n\n        setUser(null);\n        setUsername('');\n    };\n    return (\n        <div className='search'>\n            <div className='search-input'>\n                <SearchOutlined style={{ fontSize: 18 }} />\n                <input type='text' placeholder='Find a user' onKeyDown={handleKey} onChange={(e) => setUsername(e.target.value)} value={username} />\n            </div>\n            {err && <span>User not found!</span>}\n            \n            <div>\n              <div className=\"search-list\">\n                \n              </div>\n        \n            </div>\n            {user && (\n                <div className='userChat' onClick={handleSelect}>\n                    <img src={user.photoURL} alt='' />\n                    <div className='userChatInfo'>\n                        <span>{user.displayName}</span>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default Search;\n"]},"metadata":{},"sourceType":"module"}