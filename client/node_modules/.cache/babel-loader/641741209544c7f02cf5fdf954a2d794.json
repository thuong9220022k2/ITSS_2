{"ast":null,"code":"var _jsxFileName = \"/home/thuong/hedspi-social/client/src/components/Post/Post.jsx\",\n    _s = $RefreshSig$();\n\nimport { useState, useContext, useEffect } from 'react';\nimport { Modal, Button, Dropdown, Space, Avatar, Tag, Divider, Popconfirm } from 'antd';\nimport moment from 'moment';\nimport { ExclamationCircleFilled, MoreOutlined, HeartOutlined, HeartFilled } from '@ant-design/icons';\nimport { doc, collection, onSnapshot, addDoc, serverTimestamp, setDoc, query, Timestamp, orderBy } from 'firebase/firestore';\nimport './post.scss';\nimport { UserContext } from '../../context/UserContext';\nimport { db } from '../../firebase';\nimport { AuthContext } from '../../context/AuthContext';\nimport PostService from '../../service/PostService';\nimport { NavLink, createSearchParams, useNavigate } from 'react-router-dom';\nimport { convertTimeStamp, convertToTimeAgo } from '../../utils/timeUtil';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  confirm\n} = Modal;\nexport default function Post(_ref) {\n  _s();\n\n  var _post$tags;\n\n  let {\n    post,\n    handleDeletePost\n  } = _ref;\n\n  const showDeleteConfirm = () => {\n    confirm({\n      title: 'この投稿を本当に削除しますか？',\n      icon: /*#__PURE__*/_jsxDEV(ExclamationCircleFilled, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 20,\n        columnNumber: 19\n      }, this),\n      content: 'この投稿を永久に削除します。',\n      okText: '削除',\n      okType: 'danger',\n      cancelText: 'キャンセル',\n\n      onOk() {\n        handleDeletePost(post._id);\n      },\n\n      onCancel() {\n        console.log('Cancel');\n      }\n\n    });\n  };\n\n  const items = [{\n    label: /*#__PURE__*/_jsxDEV(NavLink, {\n      to: `/post/${post._id}/edit`,\n      children: \"\\u6295\\u7A3F\\u3092\\u7DE8\\u96C6\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 35,\n      columnNumber: 20\n    }, this),\n    key: '0'\n  }, {\n    label: /*#__PURE__*/_jsxDEV(\"p\", {\n      target: \"_blank\",\n      rel: \"noopener noreferrer\",\n      href: \"#\",\n      onClick: showDeleteConfirm,\n      children: \"\\u524A\\u9664\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 40,\n      columnNumber: 17\n    }, this),\n    key: '1'\n  }];\n  const [isChildFocused, setChildFocused] = useState(false);\n  const {\n    listUser\n  } = useContext(UserContext);\n  const {\n    currentUser\n  } = useContext(AuthContext);\n  const [like, setLike] = useState(post.likes.length);\n  const [isLiked, setIsLiked] = useState(false);\n  const [comment, setComment] = useState('');\n  const [listComment, setListComment] = useState([]);\n  const postUser = listUser[post.uid];\n\n  const handleChildFocus = () => {\n    setChildFocused(true);\n  };\n\n  const handleChildBlur = () => {\n    setChildFocused(false);\n  };\n\n  const handleLike = async () => {\n    const {\n      liked\n    } = await PostService.likePost(post._id);\n\n    if (like == 1) {\n      post.likes.push(currentUser.uid);\n    } else if (like == -1) {\n      post.likes.remove(currentUser.uid);\n    }\n\n    setLike(like + liked);\n    setIsLiked(liked == 1);\n  };\n\n  const handleComment = async () => {\n    if (comment) {\n      console.log('comment', comment);\n      const docRef = await addDoc(collection(db, 'posts', post._id, 'comments'), {\n        uid: currentUser.uid,\n        content: comment,\n        timeStamp: serverTimestamp()\n      });\n      console.log('Document written with ID: ', docRef.id);\n      setComment('');\n    }\n  };\n\n  useEffect(() => {\n    setIsLiked(post.likes.includes(currentUser.uid));\n    setLike(post.likes.length);\n  }, [currentUser.uid, post.likes, post._id]);\n  useEffect(() => {\n    const q = query(collection(db, 'posts', post._id, 'comments'), orderBy('timeStamp', 'asc'));\n    const unsubscribe = onSnapshot(q, querySnapshot => {\n      let comments = [];\n      querySnapshot.forEach(doc => {\n        comments.push(doc.data());\n      });\n      setListComment(comments);\n      console.log('[list comments]', comments);\n    });\n    return () => {\n      console.log(\"cancel\", post._id);\n      unsubscribe();\n    };\n  }, [post._id]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"post mt-16\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"post-header\",\n      children: [/*#__PURE__*/_jsxDEV(Space, {\n        children: [/*#__PURE__*/_jsxDEV(NavLink, {\n          className: \"user-link\",\n          to: currentUser.uid === post.uid ? 'me' : `/profile/${post.uid}`,\n          children: /*#__PURE__*/_jsxDEV(Avatar, {\n            src: postUser === null || postUser === void 0 ? void 0 : postUser.photoURL\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 114,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Space, {\n          direction: \"vertical\",\n          size: 4,\n          children: [/*#__PURE__*/_jsxDEV(NavLink, {\n            className: \"user-link\",\n            to: currentUser.uid === post.uid ? '/me' : `/profile/${post.uid}`,\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"post-username\",\n              children: postUser === null || postUser === void 0 ? void 0 : postUser.displayName\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 118,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"post-timestamp\",\n            children: convertToTimeAgo(post === null || post === void 0 ? void 0 : post.createdAt)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 120,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 21\n        }, this), (post === null || post === void 0 ? void 0 : post.is_approved) !== 'pending' || /*#__PURE__*/_jsxDEV(Tag, {\n          color: \"gold\",\n          children: \"pending\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 57\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 17\n      }, this), currentUser.uid === post.uid ? /*#__PURE__*/_jsxDEV(Dropdown, {\n        className: \"avatar\",\n        placement: \"bottomRight\",\n        menu: {\n          items\n        },\n        children: /*#__PURE__*/_jsxDEV(MoreOutlined, {\n          style: {\n            fontSize: 24\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 21\n      }, this) : '']\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"post-content\",\n      dangerouslySetInnerHTML: {\n        __html: post.content\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"checkbox\",\n      name: \"readmore\",\n      id: \"readmore\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"post-tag mt-16\",\n      children: (_post$tags = post.tags) === null || _post$tags === void 0 ? void 0 : _post$tags.map(tag => {\n        return /*#__PURE__*/_jsxDEV(Tag, {\n          children: [\"#\", tag]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 28\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Divider, {\n      style: {\n        margin: '8px 0'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"post-action\",\n      children: [/*#__PURE__*/_jsxDEV(Space, {\n        className: \"post-like\",\n        children: [isLiked ? /*#__PURE__*/_jsxDEV(HeartFilled, {\n          onClick: handleLike,\n          style: {\n            fontSize: 24,\n            color: 'red'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 25\n        }, this) : /*#__PURE__*/_jsxDEV(HeartOutlined, {\n          onClick: handleLike,\n          style: {\n            fontSize: 24\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 25\n        }, this), like]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"post-comment\",\n        children: [\"\\u30B3\\u30E1\\u30F3\\u30C8\", listComment.length, \"\\u4EF6 \"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Divider, {\n      style: {\n        margin: '8px 0'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Space, {\n      direction: \"vertical\",\n      children: listComment.map((comment, id) => {\n        const commentUser = listUser[comment.uid];\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"post-comment-container\",\n          children: [/*#__PURE__*/_jsxDEV(NavLink, {\n            className: \"user-link\",\n            to: currentUser.uid === post.uid ? 'me' : `/profile/${commentUser.uid}`,\n            children: /*#__PURE__*/_jsxDEV(Avatar, {\n              src: commentUser === null || commentUser === void 0 ? void 0 : commentUser.photoURL\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 168,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 167,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Space, {\n            direction: \"vertical\",\n            size: 4,\n            className: \"ml-16\",\n            children: [/*#__PURE__*/_jsxDEV(Space, {\n              className: \"post-comments\",\n              size: 4,\n              children: [/*#__PURE__*/_jsxDEV(NavLink, {\n                className: \"user-link post-username\",\n                to: currentUser.uid === post.uid ? '/me' : `/profile/${commentUser.uid}`,\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"\",\n                  children: commentUser === null || commentUser === void 0 ? void 0 : commentUser.displayName\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 173,\n                  columnNumber: 41\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 172,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                children: comment.content\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 175,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 171,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"post-timestamp\",\n              children: convertToTimeAgo(convertTimeStamp(comment === null || comment === void 0 ? void 0 : comment.timeStamp))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 177,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 170,\n            columnNumber: 29\n          }, this)]\n        }, id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 25\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Space, {\n      className: `post-add `,\n      children: [/*#__PURE__*/_jsxDEV(Avatar, {\n        className: \"add-cmt\",\n        src: currentUser === null || currentUser === void 0 ? void 0 : currentUser.photoURL\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        value: comment,\n        className: `post-input ${isChildFocused ? 'active' : ''}`,\n        onFocus: handleChildFocus,\n        onChange: e => {\n          setComment(e.target.value);\n        },\n        onBlur: handleChildBlur,\n        placeholder: \"\\u30B3\\u30E1\\u30F3\\u30C8\\u3092\\u5165\\u529B...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        type: \"link\",\n        onClick: handleComment,\n        children: \"\\u30DD\\u30B9\\u30C8\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 110,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Post, \"cgKrHm8xMLktTa6zFmbxwRl6I1g=\");\n\n_c = Post;\n\nvar _c;\n\n$RefreshReg$(_c, \"Post\");","map":{"version":3,"sources":["/home/thuong/hedspi-social/client/src/components/Post/Post.jsx"],"names":["useState","useContext","useEffect","Modal","Button","Dropdown","Space","Avatar","Tag","Divider","Popconfirm","moment","ExclamationCircleFilled","MoreOutlined","HeartOutlined","HeartFilled","doc","collection","onSnapshot","addDoc","serverTimestamp","setDoc","query","Timestamp","orderBy","UserContext","db","AuthContext","PostService","NavLink","createSearchParams","useNavigate","convertTimeStamp","convertToTimeAgo","confirm","Post","post","handleDeletePost","showDeleteConfirm","title","icon","content","okText","okType","cancelText","onOk","_id","onCancel","console","log","items","label","key","isChildFocused","setChildFocused","listUser","currentUser","like","setLike","likes","length","isLiked","setIsLiked","comment","setComment","listComment","setListComment","postUser","uid","handleChildFocus","handleChildBlur","handleLike","liked","likePost","push","remove","handleComment","docRef","timeStamp","id","includes","q","unsubscribe","querySnapshot","comments","forEach","data","photoURL","displayName","createdAt","is_approved","fontSize","__html","tags","map","tag","margin","color","commentUser","e","target","value"],"mappings":"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","sourcesContent":["import { useState, useContext, useEffect } from 'react';\nimport { Modal, Button, Dropdown, Space, Avatar, Tag, Divider, Popconfirm } from 'antd';\nimport moment from 'moment';\nimport { ExclamationCircleFilled, MoreOutlined, HeartOutlined, HeartFilled } from '@ant-design/icons';\nimport { doc, collection, onSnapshot, addDoc, serverTimestamp, setDoc, query, Timestamp, orderBy } from 'firebase/firestore';\n\nimport './post.scss';\nimport { UserContext } from '../../context/UserContext';\nimport { db } from '../../firebase';\nimport { AuthContext } from '../../context/AuthContext';\nimport PostService from '../../service/PostService';\nimport { NavLink, createSearchParams, useNavigate } from 'react-router-dom';\nimport { convertTimeStamp, convertToTimeAgo } from '../../utils/timeUtil';\n\nconst { confirm } = Modal;\nexport default function Post({ post, handleDeletePost }) {\n    const showDeleteConfirm = () => {\n        confirm({\n            title: 'この投稿を本当に削除しますか？',\n            icon: <ExclamationCircleFilled />,\n            content: 'この投稿を永久に削除します。',\n            okText: '削除',\n            okType: 'danger',\n            cancelText: 'キャンセル',\n            onOk() {\n                handleDeletePost(post._id);\n            },\n            onCancel() {\n                console.log('Cancel');\n            },\n        });\n    };\n    const items = [\n        {\n            label: <NavLink to={`/post/${post._id}/edit`}>投稿を編集</NavLink>,\n            key: '0',\n        },\n        {\n            label: (\n                <p target='_blank' rel='noopener noreferrer' href='#' onClick={showDeleteConfirm}>\n                    削除\n                </p>\n            ),\n            key: '1',\n        },\n    ];\n    const [isChildFocused, setChildFocused] = useState(false);\n    const { listUser } = useContext(UserContext);\n    const { currentUser } = useContext(AuthContext);\n    const [like, setLike] = useState(post.likes.length);\n    const [isLiked, setIsLiked] = useState(false);\n    const [comment, setComment] = useState('');\n    const [listComment, setListComment] = useState([]);\n    const postUser = listUser[post.uid];\n    const handleChildFocus = () => {\n        setChildFocused(true);\n    };\n\n    const handleChildBlur = () => {\n        setChildFocused(false);\n    };\n\n    const handleLike = async () => {\n        const { liked } = await PostService.likePost(post._id);\n        if(like==1){\n            post.likes.push(currentUser.uid);\n        }else if(like==-1){\n            post.likes.remove(currentUser.uid);\n\n        }\n        setLike(like + liked);\n        setIsLiked(liked == 1);\n    };\n\n    const handleComment = async () => {\n        if (comment) {\n            console.log('comment', comment);\n            const docRef = await addDoc(collection(db, 'posts', post._id, 'comments'), {\n                uid: currentUser.uid,\n                content: comment,\n                timeStamp: serverTimestamp(),\n            });\n            console.log('Document written with ID: ', docRef.id);\n            setComment('');\n        }\n    };\n    useEffect(() => {\n        setIsLiked(post.likes.includes(currentUser.uid));\n        setLike(post.likes.length);\n        \n    }, [currentUser.uid, post.likes,post._id]);\n\n    useEffect(() => {\n        const q = query(collection(db, 'posts', post._id, 'comments'),orderBy('timeStamp','asc'));\n        const unsubscribe = onSnapshot(q, (querySnapshot) => {\n            let comments = [];\n            querySnapshot.forEach((doc) => {\n                comments.push(doc.data());\n            });\n\n            setListComment(comments);\n            console.log('[list comments]', comments);\n        });\n        return () => {\n            console.log(\"cancel\",post._id)\n            unsubscribe();\n        };\n    }, [post._id]);\n    return (\n        <div className='post mt-16'>\n            <div className='post-header'>\n                <Space>\n                    <NavLink className='user-link' to={currentUser.uid === post.uid ? 'me' : `/profile/${post.uid}`}>\n                        <Avatar src={postUser?.photoURL}></Avatar>\n                    </NavLink>\n                    <Space direction='vertical' size={4}>\n                        <NavLink className='user-link' to={currentUser.uid === post.uid ? '/me' : `/profile/${post.uid}`}>\n                            <div className='post-username'>{postUser?.displayName}</div>\n                        </NavLink>\n                        <div className='post-timestamp'>{convertToTimeAgo(post?.createdAt)}</div>\n                    </Space>\n                    {post?.is_approved !== 'pending' || <Tag color='gold'>pending</Tag>}\n                </Space>\n                {currentUser.uid === post.uid ? (\n                    <Dropdown\n                        className='avatar'\n                        placement='bottomRight'\n                        menu={{\n                            items,\n                        }}\n                    >\n                        <MoreOutlined style={{ fontSize: 24 }} />\n                    </Dropdown>\n                ) : (\n                    ''\n                )}\n            </div>\n\n            <div className='post-content' dangerouslySetInnerHTML={{ __html: post.content }}></div>\n            <input type='checkbox' name='readmore' id='readmore'></input>\n\n            <div className='post-tag mt-16'>\n                {post.tags?.map((tag) => {\n                    return <Tag>#{tag}</Tag>;\n                })}\n            </div>\n            <Divider style={{ margin: '8px 0' }}></Divider>\n\n            <div className='post-action'>\n                <Space className='post-like'>\n                    {isLiked ? (\n                        <HeartFilled onClick={handleLike} style={{ fontSize: 24, color: 'red' }} />\n                    ) : (\n                        <HeartOutlined onClick={handleLike} style={{ fontSize: 24 }} />\n                    )}\n                    {like}\n                </Space>\n                <div className='post-comment'>コメント{listComment.length}件 </div>\n            </div>\n            <Divider style={{ margin: '8px 0' }}></Divider>\n            <Space direction='vertical'>\n                {listComment.map((comment, id) => {\n                    const commentUser = listUser[comment.uid];\n\n                    return (\n                        <div className='post-comment-container' key={id}>\n                            <NavLink className='user-link' to={currentUser.uid === post.uid ? 'me' : `/profile/${commentUser.uid}`}>\n                                <Avatar src={commentUser?.photoURL}></Avatar>\n                            </NavLink>\n                            <Space direction='vertical' size={4} className='ml-16'>\n                                <Space className='post-comments' size={4}>\n                                    <NavLink className='user-link post-username' to={currentUser.uid === post.uid ? '/me' : `/profile/${commentUser.uid}`}>\n                                        <div className=''>{commentUser?.displayName}</div>\n                                    </NavLink>\n                                    <p>{comment.content}</p>\n                                </Space>\n                                <div className='post-timestamp'>{convertToTimeAgo(convertTimeStamp(comment?.timeStamp))}</div>\n                            </Space>\n                        </div>\n                    );\n                })}\n            </Space>\n            <Space className={`post-add `}>\n                <Avatar className='add-cmt' src={currentUser?.photoURL}></Avatar>\n                <input\n                    type='text'\n                    value={comment}\n                    className={`post-input ${isChildFocused ? 'active' : ''}`}\n                    onFocus={handleChildFocus}\n                    onChange={(e) => {\n                        setComment(e.target.value);\n                    }}\n                    onBlur={handleChildBlur}\n                    placeholder='コメントを入力...'\n                />\n                <Button type='link' onClick={handleComment}>\n                    ポスト\n                </Button>\n            </Space>\n        </div>\n    );\n}\n"]},"metadata":{},"sourceType":"module"}