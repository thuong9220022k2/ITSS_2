{"ast":null,"code":"var _jsxFileName = \"/home/thuong/hedspi-social/client/src/pages/MyProfile/MyProfile.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useCallback, useContext, useEffect, useState } from 'react';\nimport { AuthContext } from '../../context/AuthContext';\nimport { Card, Avatar, Space, Button, Modal, Form, Input } from 'antd';\nimport { EditOutlined, CameraOutlined } from '@ant-design/icons';\nimport { getDownloadURL, ref, uploadBytesResumable } from 'firebase/storage';\nimport Post from '../../components/Post/Post';\nimport ReactQuill from 'react-quill';\nimport './myprofile.scss';\nimport PostService from '../../service/PostService';\nimport { storage } from '../../firebase';\nimport { UserContext } from '../../context/UserContext';\nimport { updateProfile } from 'firebase/auth';\nimport { doc, collection, onSnapshot, addDoc, serverTimestamp, setDoc, query, Timestamp } from 'firebase/firestore';\nimport { db } from '../../firebase';\nimport { message } from 'antd';\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Profile() {\n  _s();\n\n  var _listUser$currentUser;\n\n  const {\n    currentUser\n  } = useContext(AuthContext);\n  const [profile, setProfile] = useState({});\n  const {\n    listUser\n  } = useContext(UserContext);\n  const [selectedFile, setSelectedFile] = useState(null);\n  const [posts, setPosts] = useState([]);\n  const [totalLike, setTotalLike] = useState(0);\n  const [form] = Form.useForm();\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [previewUrl, setPreviewUrl] = useState(currentUser === null || currentUser === void 0 ? void 0 : currentUser.photoURL);\n\n  const handleGetPost = async () => {\n    let posts = await PostService.getMyPosts();\n    console.log('[Profile]', posts);\n    setPosts(posts);\n  };\n\n  const handleDeletePost = useCallback(async postId => {\n    const result = await PostService.deletePost(postId);\n\n    if (result) {\n      setPosts(oldPost => oldPost.filter(post => post._id !== postId));\n    }\n  }, [posts]);\n\n  const handleUpload = async _ref => {\n    let {\n      displayName,\n      story\n    } = _ref;\n    let url = currentUser === null || currentUser === void 0 ? void 0 : currentUser.photoURL;\n\n    if (selectedFile) {\n      console.log('selectedFile', selectedFile);\n      const storageRef = ref(storage, `${currentUser === null || currentUser === void 0 ? void 0 : currentUser.email}`);\n      await uploadBytesResumable(storageRef, selectedFile).then(async () => {\n        await getDownloadURL(storageRef).then(async downloadURL => {\n          setPreviewUrl(downloadURL);\n          console.log('new new', displayName);\n          await updateProfile(currentUser, {\n            displayName: displayName,\n            photoURL: downloadURL\n          }); //create user on firestore\n\n          await setDoc(doc(db, 'users', currentUser.uid), {\n            uid: currentUser === null || currentUser === void 0 ? void 0 : currentUser.uid,\n            email: currentUser === null || currentUser === void 0 ? void 0 : currentUser.email,\n            photoURL: downloadURL,\n            displayName: displayName,\n            story\n          }).then(() => {\n            message.open({\n              type: 'success',\n              content: 'プロフィールの更新に成功しました。'\n            });\n            setIsModalOpen(false);\n          }).catch(err => {\n            message.open({\n              type: 'error',\n              content: err\n            });\n            console.log(err);\n          });\n        });\n      });\n    } else {\n      await updateProfile(currentUser, {\n        displayName: displayName\n      }); //create user on firestore\n\n      await setDoc(doc(db, 'users', currentUser.uid), {\n        uid: currentUser === null || currentUser === void 0 ? void 0 : currentUser.uid,\n        email: currentUser === null || currentUser === void 0 ? void 0 : currentUser.email,\n        photoURL: previewUrl,\n        displayName: displayName,\n        story: story || ''\n      }).then(() => {\n        message.open({\n          type: 'success',\n          content: 'プロフィールの更新に成功しました。'\n        });\n        setIsModalOpen(false);\n      }).catch(err => {\n        message.open({\n          type: 'error',\n          content: err\n        });\n        console.log(err);\n      });\n    }\n  };\n\n  const handleFileChange = event => {\n    const file = event.target.files[0];\n    setSelectedFile(file);\n\n    if (file) {\n      const reader = new FileReader();\n\n      reader.onloadend = () => {\n        setPreviewUrl(reader.result);\n      };\n\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const onFinishEdit = async values => {\n    await handleUpload(values);\n    console.log('Success:', { ...values,\n      previewUrl\n    });\n  };\n\n  const handleOk = async () => {\n    await form.submit();\n  };\n\n  const onFinishFailed = errorInfo => {\n    console.log('Failed:', errorInfo);\n  };\n\n  const handleCancel = () => {\n    setIsModalOpen(false);\n  };\n\n  const showModal = () => {\n    setPreviewUrl(currentUser === null || currentUser === void 0 ? void 0 : currentUser.photoURL);\n    setIsModalOpen(true);\n    form.setFieldsValue({\n      displayName: currentUser.displayName,\n      story: listUser[currentUser.uid].story\n    });\n  };\n\n  useEffect(() => {\n    const totalLike = posts.reduce((total, post) => {\n      return total + post.likes.length;\n    }, 0);\n    setTotalLike(totalLike);\n  }, [posts]);\n  useEffect(() => {\n    handleGetPost();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"profile-container\",\n    children: [/*#__PURE__*/_jsxDEV(Card, {\n      hoverable: true,\n      className: \"profile mt-16 mr-16\",\n      children: /*#__PURE__*/_jsxDEV(Space, {\n        direction: \"vertical\",\n        children: [/*#__PURE__*/_jsxDEV(Space, {\n          direction: \"vertical\",\n          children: [/*#__PURE__*/_jsxDEV(Avatar, {\n            src: currentUser.photoURL,\n            size: 100\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 164,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Space, {\n            direction: \"vertical\",\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              className: \"profile-name\",\n              children: [currentUser.displayName, \" \"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 166,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: currentUser.email\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 168,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: showModal,\n          className: \"edit-btn\",\n          type: \"text\",\n          icon: /*#__PURE__*/_jsxDEV(EditOutlined, {\n            style: {\n              fontSize: 24\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 175,\n            columnNumber: 19\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"post-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"mr-16\",\n            children: [/*#__PURE__*/_jsxDEV(\"b\", {\n              children: [\" \", posts.length]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 179,\n              columnNumber: 15\n            }, this), \" \\u6295\\u7A3F\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [/*#__PURE__*/_jsxDEV(\"b\", {\n              children: totalLike\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 182,\n              columnNumber: 15\n            }, this), \" \\u3044\\u3044\\u306D\\uFF01\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 181,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"b\", {\n            children: \"\\u7269\\u8A9E:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 186,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            dangerouslySetInnerHTML: {\n              __html: (_listUser$currentUser = listUser[currentUser.uid]) === null || _listUser$currentUser === void 0 ? void 0 : _listUser$currentUser.story\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [' ', posts === null || posts === void 0 ? void 0 : posts.map(post => /*#__PURE__*/_jsxDEV(Post, {\n        post: post,\n        handleDeletePost: handleDeletePost\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 11\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      width: 700,\n      title: \"\\u30D7\\u30ED\\u30D5\\u30A3\\u30FC\\u30EB\\u3092\\u7DE8\\u96C6\",\n      open: isModalOpen,\n      onOk: handleOk,\n      onCancel: handleCancel,\n      okText: \"保存\",\n      cancelText: \"キャンセル\",\n      children: /*#__PURE__*/_jsxDEV(Form, {\n        form: form,\n        name: \"project-create\",\n        labelCol: {\n          span: 6\n        },\n        autoComplete: \"off\",\n        onFinish: onFinishEdit,\n        onFinishFailed: onFinishFailed,\n        children: [/*#__PURE__*/_jsxDEV(Form.Item, {\n          label: \"\\u30D7\\u30ED\\u30D5\\u30A3\\u30FC\\u30EB\\u5199\\u771F\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            onChange: handleFileChange,\n            id: \"file\",\n            style: {\n              display: 'none'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 220,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              position: 'relative',\n              display: 'inline-block'\n            },\n            children: [/*#__PURE__*/_jsxDEV(Avatar, {\n              size: 148,\n              src: previewUrl,\n              className: \"preview-avt\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 227,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"file\",\n              className: \"upload-icon\",\n              children: /*#__PURE__*/_jsxDEV(CameraOutlined, {\n                style: {\n                  fontSize: '20px',\n                  cursor: 'pointer'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 233,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 232,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 226,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n          label: \"\\u540D\\u524D\",\n          name: \"displayName\",\n          rules: [{\n            required: true,\n            message: 'Hãy nhập tên hiển thị'\n          }],\n          children: /*#__PURE__*/_jsxDEV(Input, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 244,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 239,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n          label: \"\\u7269\\u8A9E\",\n          name: \"story\",\n          children: /*#__PURE__*/_jsxDEV(ReactQuill, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 247,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 160,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Profile, \"FDwl0stKXiiXCV1a1rz9nl+deLg=\", false, function () {\n  return [Form.useForm];\n});\n\n_c = Profile;\n\nvar _c;\n\n$RefreshReg$(_c, \"Profile\");","map":{"version":3,"sources":["/home/thuong/hedspi-social/client/src/pages/MyProfile/MyProfile.jsx"],"names":["React","useCallback","useContext","useEffect","useState","AuthContext","Card","Avatar","Space","Button","Modal","Form","Input","EditOutlined","CameraOutlined","getDownloadURL","ref","uploadBytesResumable","Post","ReactQuill","PostService","storage","UserContext","updateProfile","doc","collection","onSnapshot","addDoc","serverTimestamp","setDoc","query","Timestamp","db","message","useNavigate","useParams","Profile","currentUser","profile","setProfile","listUser","selectedFile","setSelectedFile","posts","setPosts","totalLike","setTotalLike","form","useForm","isModalOpen","setIsModalOpen","previewUrl","setPreviewUrl","photoURL","handleGetPost","getMyPosts","console","log","handleDeletePost","postId","result","deletePost","oldPost","filter","post","_id","handleUpload","displayName","story","url","storageRef","email","then","downloadURL","uid","open","type","content","catch","err","handleFileChange","event","file","target","files","reader","FileReader","onloadend","readAsDataURL","onFinishEdit","values","handleOk","submit","onFinishFailed","errorInfo","handleCancel","showModal","setFieldsValue","reduce","total","likes","length","fontSize","__html","map","span","display","position","cursor","required"],"mappings":"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","sourcesContent":["import React, { useCallback, useContext, useEffect, useState } from 'react';\nimport { AuthContext } from '../../context/AuthContext';\nimport { Card, Avatar, Space, Button, Modal, Form, Input } from 'antd';\nimport { EditOutlined, CameraOutlined } from '@ant-design/icons';\nimport { getDownloadURL, ref, uploadBytesResumable } from 'firebase/storage';\nimport Post from '../../components/Post/Post';\nimport ReactQuill from 'react-quill';\nimport './myprofile.scss';\nimport PostService from '../../service/PostService';\nimport { storage } from '../../firebase';\nimport { UserContext } from '../../context/UserContext';\nimport { updateProfile } from 'firebase/auth';\nimport {\n  doc,\n  collection,\n  onSnapshot,\n  addDoc,\n  serverTimestamp,\n  setDoc,\n  query,\n  Timestamp,\n} from 'firebase/firestore';\nimport { db } from '../../firebase';\nimport { message } from 'antd';\nimport { useNavigate, useParams  } from \"react-router-dom\";\n\nexport default function Profile() {\n  const { currentUser } = useContext(AuthContext);\n  const [profile,setProfile]=useState({});\n  const { listUser } = useContext(UserContext);\n  const [selectedFile, setSelectedFile] = useState(null);\n  const [posts, setPosts] = useState([]);\n  const [totalLike, setTotalLike] = useState(0);\n  const [form] = Form.useForm();\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [previewUrl, setPreviewUrl] = useState(currentUser?.photoURL);\n\n \n  const handleGetPost = async () => {\n    let posts = await PostService.getMyPosts();\n    console.log('[Profile]', posts);\n    setPosts(posts);\n  };\n  const handleDeletePost = useCallback(\n    async postId => {\n      const result = await PostService.deletePost(postId);\n      if (result) {\n        setPosts(oldPost => oldPost.filter(post => post._id !== postId));\n      }\n    },\n    [posts]\n  );\n  const handleUpload = async ({ displayName, story }) => {\n    let url = currentUser?.photoURL;\n    if (selectedFile) {\n      console.log('selectedFile', selectedFile);\n      const storageRef = ref(storage, `${currentUser?.email}`);\n      await uploadBytesResumable(storageRef, selectedFile).then(async () => {\n        await getDownloadURL(storageRef).then(async downloadURL => {\n          setPreviewUrl(downloadURL);\n          console.log('new new', displayName);\n          await updateProfile(currentUser, {\n            displayName: displayName,\n            photoURL: downloadURL,\n          });\n          //create user on firestore\n          await setDoc(doc(db, 'users', currentUser.uid), {\n            uid: currentUser?.uid,\n            email: currentUser?.email,\n            photoURL: downloadURL,\n            displayName: displayName,\n            story,\n          })\n            .then(() => {\n              message.open({\n                type: 'success',\n                content: 'プロフィールの更新に成功しました。',\n              });\n              setIsModalOpen(false);\n            })\n            .catch(err => {\n              message.open({ type: 'error', content: err });\n\n              console.log(err);\n            });\n        });\n      });\n    } else {\n      await updateProfile(currentUser, {\n        displayName: displayName,\n      });\n      //create user on firestore\n      await setDoc(doc(db, 'users', currentUser.uid), {\n        uid: currentUser?.uid,\n        email: currentUser?.email,\n        photoURL: previewUrl,\n        displayName: displayName,\n        story: story || '',\n      })\n        .then(() => {\n          message.open({\n            type: 'success',\n            content: 'プロフィールの更新に成功しました。',\n          });\n          setIsModalOpen(false);\n        })\n        .catch(err => {\n          message.open({ type: 'error', content: err });\n\n          console.log(err);\n        });\n    }\n  };\n  const handleFileChange = event => {\n    const file = event.target.files[0];\n    setSelectedFile(file);\n\n    if (file) {\n      const reader = new FileReader();\n\n      reader.onloadend = () => {\n        setPreviewUrl(reader.result);\n      };\n\n      reader.readAsDataURL(file);\n    }\n  };\n  const onFinishEdit = async values => {\n    await handleUpload(values);\n    console.log('Success:', { ...values, previewUrl });\n  };\n  const handleOk = async () => {\n    await form.submit();\n  };\n  const onFinishFailed = errorInfo => {\n    console.log('Failed:', errorInfo);\n  };\n\n  const handleCancel = () => {\n    setIsModalOpen(false);\n  };\n  const showModal = () => {\n    setPreviewUrl(currentUser?.photoURL);\n    setIsModalOpen(true);\n    form.setFieldsValue({\n      displayName: currentUser.displayName,\n      story: listUser[currentUser.uid].story,\n    });\n  };\n  useEffect(() => {\n    const totalLike = posts.reduce((total, post) => {\n      return total + post.likes.length;\n    }, 0);\n    setTotalLike(totalLike);\n  }, [posts]);\n  useEffect(() => {\n    handleGetPost();\n  }, []);\n  return (\n    <div className=\"profile-container\">\n      <Card hoverable={true} className=\"profile mt-16 mr-16\">\n        <Space direction=\"vertical\">\n          <Space direction=\"vertical\">\n            <Avatar src={currentUser.photoURL} size={100}></Avatar>\n            <Space direction=\"vertical\">\n              <h3 className=\"profile-name\">{currentUser.displayName} </h3>\n\n              <p>{currentUser.email}</p>\n            </Space>\n          </Space>\n          <Button\n            onClick={showModal}\n            className=\"edit-btn\"\n            type=\"text\"\n            icon={<EditOutlined style={{ fontSize: 24 }} />}\n          ></Button>\n          <div className=\"post-info\">\n            <span className=\"mr-16\">\n              <b> {posts.length}</b> 投稿\n            </span>\n            <span>\n              <b>{totalLike}</b> いいね！\n            </span>\n          </div>\n          <div>\n            <b>物語:</b>\n            <p\n              dangerouslySetInnerHTML={{\n                __html: listUser[currentUser.uid]?.story,\n              }}\n            ></p>\n          </div>\n        </Space>\n      </Card>\n      <div>\n        {' '}\n        {posts?.map(post => (\n          <Post post={post} handleDeletePost={handleDeletePost}></Post>\n        ))}\n      </div>\n\n      <Modal\n        width={700}\n        title=\"プロフィールを編集\"\n        open={isModalOpen}\n        onOk={handleOk}\n        onCancel={handleCancel}\n        okText={\"保存\"}\n        cancelText={\"キャンセル\"}\n      >\n        <Form\n          form={form}\n          name=\"project-create\"\n          labelCol={{ span: 6 }}\n          autoComplete=\"off\"\n          onFinish={onFinishEdit}\n          onFinishFailed={onFinishFailed}\n        >\n          <Form.Item label=\"プロフィール写真\">\n            <input\n              type=\"file\"\n              onChange={handleFileChange}\n              id=\"file\"\n              style={{ display: 'none' }}\n            />\n            <div style={{ position: 'relative', display: 'inline-block' }}>\n              <Avatar\n                size={148}\n                src={previewUrl}\n                className=\"preview-avt\"\n              ></Avatar>\n              <label htmlFor=\"file\" className=\"upload-icon\">\n                <CameraOutlined\n                  style={{ fontSize: '20px', cursor: 'pointer' }}\n                />\n              </label>\n            </div>\n          </Form.Item>\n          <Form.Item\n            label=\"名前\"\n            name=\"displayName\"\n            rules={[{ required: true, message: 'Hãy nhập tên hiển thị' }]}\n          >\n            <Input />\n          </Form.Item>\n          <Form.Item label=\"物語\" name=\"story\">\n            <ReactQuill></ReactQuill>\n          </Form.Item>\n        </Form>\n      </Modal>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}